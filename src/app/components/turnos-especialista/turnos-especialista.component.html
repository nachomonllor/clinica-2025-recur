<!-- turnos-especialista.component.html -->
<mat-toolbar color="primary">
  <span>Clínica OnLine</span>
  <span class="spacer"></span>
  <button mat-button routerLink="/register">Registrarse</button>
</mat-toolbar>

<div class="page-container">
  <mat-card class="turnos-card">
    <mat-card-title>Turnos del especialista</mat-card-title>

    <div class="filter-container">
      <mat-form-field appearance="outline">
        <mat-label>Filtrar por paciente o especialidad</mat-label>
        <input matInput [(ngModel)]="filterTerm" (ngModelChange)="onFilterChange()" />
        <button mat-icon-button *ngIf="filterTerm" (click)="filterTerm=''; onFilterChange();">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </div>

    <table mat-table [dataSource]="dataSource" class="mat-elevation-z2" *ngIf="dataSource.length">

      <!-- ID -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef> ID </th>
        <td mat-cell *matCellDef="let t"> {{t.id}} </td>
      </ng-container>

      <!-- Fecha -->
      <ng-container matColumnDef="fecha">
        <th mat-header-cell *matHeaderCellDef> Fecha </th>
        <td mat-cell *matCellDef="let t"> {{t.fecha}} </td>
      </ng-container>

      <!-- Hora -->
      <ng-container matColumnDef="hora">
        <th mat-header-cell *matHeaderCellDef> Hora </th>
        <td mat-cell *matCellDef="let t"> {{t.hora}} </td>
      </ng-container>

      <!-- Especialidad -->
      <ng-container matColumnDef="especialidad">
        <th mat-header-cell *matHeaderCellDef> Especialidad </th>
        <td mat-cell *matCellDef="let t"> {{t.especialidad}} </td>
      </ng-container>

      <!-- Paciente -->
      <ng-container matColumnDef="paciente">
        <th mat-header-cell *matHeaderCellDef> Paciente </th>
        <td mat-cell *matCellDef="let t"> {{t.paciente}} </td>
      </ng-container>

      <!-- Estado -->
      <ng-container matColumnDef="estado">
        <th mat-header-cell *matHeaderCellDef> Estado </th>
        <td mat-cell *matCellDef="let t"> {{t.estado}} </td>
      </ng-container>

      <!-- Acciones -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef> Acciones </th>
        <td mat-cell *matCellDef="let t">
          <!-- por ejemplo: -->
          <!-- button mat-button color="warn" (click)="cancelarTurno(t)" *ngIf="t.estado==='pendiente'">Cancelar</button -->

          <button mat-button color="warn" (click)="confirmarCancelar(t)" *ngIf="t.estado==='pendiente'"> Cancelar </button>

          <button mat-button color="primary" (click)="confirmarAceptar(t)" *ngIf="t.estado==='pendiente'"> Aceptar </button>

          <button mat-button (click)="confirmarFinalizar(t)" *ngIf="t.estado==='aceptado'"> Finalizar </button>

          <button mat-button (click)="verResena(t)" *ngIf="t.resena">
            Ver reseña
          </button>

        </td>
      </ng-container>

      <!-- Filas -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <div class="no-data" *ngIf="!dataSource.length">
      No hay turnos para mostrar.
    </div>
  </mat-card>
</div>



<!-- div class="turnos-especialista-container">
    <h2>Turnos Asignados</h2>
    
     Filtro único (sin combobox) 
    <div class="filter-container">
      <input 
        type="text" 
        placeholder="Filtra por especialidad o paciente" 
        [(ngModel)]="filterTerm" 
        (ngModelChange)="onFilterChange()" 
      />
    </div>
    
     Listado de turnos 
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Fecha</th>
          <th>Hora</th>
          <th>Especialidad</th>
          <th>Paciente</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let turno of filteredTurnos">
          <td>{{ turno.id }}</td>
          <td>{{ turno.fecha }}</td>
          <td>{{ turno.hora }}</td>
          <td>{{ turno.especialidad }}</td>
          <td>{{ turno.paciente }}</td>
          <td>{{ turno.estado }}</td>
          <td>
             Cancelar turno: visible si el turno no fue aceptado, realizado o rechazado 
            <button 
              *ngIf="turno.estado !== 'aceptado' && turno.estado !== 'realizado' && turno.estado !== 'rechazado'" 
              (click)="cancelarTurno(turno)">
              Cancelar turno
            </button>
             Rechazar turno: visible si el turno no fue aceptado, realizado o cancelado 
            <button 
              *ngIf="turno.estado !== 'aceptado' && turno.estado !== 'realizado' && turno.estado !== 'cancelado'" 
              (click)="rechazarTurno(turno)">
              Rechazar turno
            </button>
             Aceptar turno: visible si el turno no fue realizado, cancelado o rechazado 
            <button 
              *ngIf="turno.estado !== 'realizado' && turno.estado !== 'cancelado' && turno.estado !== 'rechazado'" 
              (click)="aceptarTurno(turno)">
              Aceptar turno
            </button>
             Finalizar turno: visible si el turno fue aceptado 
            <button 
              *ngIf="turno.estado === 'aceptado'" 
              (click)="finalizarTurno(turno)">
              Finalizar turno
            </button>
             Ver reseña: visible si el turno tiene reseña cargada 
            <button 
              *ngIf="turno.resena" 
              (click)="verResena(turno)">
              Ver reseña
            </button>
          </td>
        </tr>
      </tbody>
    </table>
    
    <p *ngIf="filteredTurnos.length === 0">No se encontraron turnos.</p>
  </div -->
   