<mat-card class="registro-container">
  <mat-card-title>Registro de Paciente</mat-card-title>

  <form [formGroup]="registroPacienteForm" (ngSubmit)="onSubmit()">

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Nombre</mat-label>
      <input matInput formControlName="nombre" placeholder="Ingresa tu nombre" />
      <mat-error *ngIf="registroPacienteForm.get('nombre')?.hasError('required')">
        El nombre es obligatorio.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Apellido</mat-label>
      <input matInput formControlName="apellido" placeholder="Ingresa tu apellido" />
      <mat-error *ngIf="registroPacienteForm.get('apellido')?.hasError('required')">
        El apellido es obligatorio.
      </mat-error>
    </mat-form-field>

    <!-- Fecha de Nacimiento -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Fecha de nacimiento</mat-label>
      <input matInput type="date" formControlName="fechaNacimiento" [min]="minDateISO" [max]="maxDateISO" />
      <mat-error *ngIf="registroPacienteForm.get('fechaNacimiento')?.hasError('required')">
        La fecha de nacimiento es obligatoria.
      </mat-error>
      <mat-error *ngIf="registroPacienteForm.get('fechaNacimiento')?.hasError('formato')">
        Formato inválido (usa AAAA-MM-DD).
      </mat-error>
      <mat-error *ngIf="registroPacienteForm.get('fechaNacimiento')?.hasError('futuro')">
        La fecha no puede ser futura.
      </mat-error>
      <mat-error *ngIf="registroPacienteForm.get('fechaNacimiento')?.hasError('rango')">
        Verifica la fecha (edad fuera de rango).
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>DNI</mat-label>
      <input matInput formControlName="dni" placeholder="Ingresa tu DNI" />
      <mat-error *ngIf="registroPacienteForm.get('dni')?.hasError('required')">
        El DNI es obligatorio.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Obra Social</mat-label>
      <input matInput formControlName="obraSocial" placeholder="Ingresa tu obra social" />
      <mat-error *ngIf="registroPacienteForm.get('obraSocial')?.hasError('required')">
        La obra social es obligatoria.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Correo Electrónico</mat-label>
      <input matInput type="email" formControlName="email" placeholder="Ingresa tu correo" />
      <mat-error *ngIf="registroPacienteForm.get('email')?.hasError('required')">
        El correo es obligatorio.
      </mat-error>
      <mat-error *ngIf="registroPacienteForm.get('email')?.hasError('email')">
        Formato inválido.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Contraseña</mat-label>
      <input matInput type="password" formControlName="password" placeholder="Ingresa tu contraseña" />
      <mat-error *ngIf="registroPacienteForm.get('password')?.hasError('required')">
        La contraseña es obligatoria.
      </mat-error>
    </mat-form-field>

    <!-- Imágenes de perfil -->
    <div class="full-width file-group">
      <button mat-raised-button color="primary" type="button" (click)="fileInput1.click()">
        Seleccionar Imagen 1
      </button>
      <input #fileInput1 type="file" hidden (change)="onFileChange($event, 1)" accept="image/*" />
      <mat-error
        *ngIf="registroPacienteForm.get('imagenPerfil1')?.hasError('required') && registroPacienteForm.get('imagenPerfil1')?.touched">
        La primera imagen es obligatoria.
      </mat-error>
      <div class="preview" *ngIf="imagenPrevia1">
        <img [src]="imagenPrevia1" alt="Previsualización 1" />
      </div>
    </div>

    <div class="full-width file-group">
      <button mat-raised-button color="primary" type="button" (click)="fileInput2.click()">
        Seleccionar Imagen 2
      </button>
      <input #fileInput2 type="file" hidden (change)="onFileChange($event, 2)" accept="image/*" />
      <mat-error
        *ngIf="registroPacienteForm.get('imagenPerfil2')?.hasError('required') && registroPacienteForm.get('imagenPerfil2')?.touched">
        La segunda imagen es obligatoria.
      </mat-error>
      <div class="preview" *ngIf="imagenPrevia2">
        <img [src]="imagenPrevia2" alt="Previsualización 2" />
      </div>
    </div>

    <!-- CAPTCHA -->
    <!-- Se muestra solo si está habilitado en environment -->
    <div class="captcha-wrapper" style="margin: 1rem 0;" *ngIf="captchaEnabled">
      <ngx-recaptcha2 formControlName="recaptcha" [siteKey]="siteKey">
      </ngx-recaptcha2>

      <div class="error"
        *ngIf="registroPacienteForm.get('recaptcha')?.invalid && registroPacienteForm.get('recaptcha')?.touched">
        Debes completar el captcha.
      </div>
    </div>

    <button mat-raised-button color="primary" type="submit" [disabled]="registroPacienteForm.invalid || loading">
      {{ loading ? 'Registrando...' : 'Registrarse' }}
    </button>

  </form>
</mat-card>

<!-- Botón Flotante (CORREGIDO) -->
<app-fab-bienvenida></app-fab-bienvenida>





<!-- <mat-card class="registro-container">
  <mat-card-title>Registro de Paciente</mat-card-title>
  <form [formGroup]="registroPacienteForm" (ngSubmit)="onSubmit()">

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Nombre</mat-label>
      <input matInput formControlName="nombre" placeholder="Ingresa tu nombre" />
      <mat-error *ngIf="registroPacienteForm.get('nombre')?.hasError('required')">
        El nombre es obligatorio.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Apellido</mat-label>
      <input matInput formControlName="apellido" placeholder="Ingresa tu apellido" />
      <mat-error *ngIf="registroPacienteForm.get('apellido')?.hasError('required')">
        El apellido es obligatorio.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Fecha de nacimiento</mat-label>
      <input matInput type="date" formControlName="fechaNacimiento" [min]="minDateISO" [max]="maxDateISO"
        placeholder="YYYY-MM-DD" />
      <mat-error *ngIf="registroPacienteForm.get('fechaNacimiento')?.hasError('required')">
        La fecha de nacimiento es obligatoria.
      </mat-error>
      <mat-error *ngIf="registroPacienteForm.get('fechaNacimiento')?.hasError('formato')">
        Formato inválido (usa AAAA-MM-DD).
      </mat-error>
      <mat-error *ngIf="registroPacienteForm.get('fechaNacimiento')?.hasError('futuro')">
        La fecha no puede ser futura.
      </mat-error>
      <mat-error *ngIf="registroPacienteForm.get('fechaNacimiento')?.hasError('rango')">
        Verifica la fecha (edad fuera de rango).
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>DNI</mat-label>
      <input matInput formControlName="dni" placeholder="Ingresa tu DNI" />
      <mat-error *ngIf="registroPacienteForm.get('dni')?.hasError('required')">
        El DNI es obligatorio.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Obra Social</mat-label>
      <input matInput formControlName="obraSocial" placeholder="Ingresa tu obra social" />
      <mat-error *ngIf="registroPacienteForm.get('obraSocial')?.hasError('required')">
        La obra social es obligatoria.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Correo Electrónico</mat-label>
      <input matInput type="email" formControlName="email" placeholder="Ingresa tu correo" />
      <mat-error *ngIf="registroPacienteForm.get('email')?.hasError('required')">
        El correo es obligatorio.
      </mat-error>
      <mat-error *ngIf="registroPacienteForm.get('email')?.hasError('email')">
        Formato inválido.
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Contraseña</mat-label>
      <input matInput type="password" formControlName="password" placeholder="Ingresa tu contraseña" />
      <mat-error *ngIf="registroPacienteForm.get('password')?.hasError('required')">
        La contraseña es obligatoria.
      </mat-error>
    </mat-form-field>

    <div class="full-width file-group">
      <button mat-raised-button color="primary" type="button" (click)="fileInput1.click()">
        Seleccionar Imagen 1
      </button>
      <input #fileInput1 type="file" hidden (change)="onFileChange($event, 1)" accept="image/*" />
      <mat-error
        *ngIf="registroPacienteForm.get('imagenPerfil1')?.hasError('required') && registroPacienteForm.get('imagenPerfil1')?.touched">
        La primera imagen es obligatoria.
      </mat-error>
      <div class="preview" *ngIf="imagenPrevia1">
        <img [src]="imagenPrevia1" alt="Previsualización 1" />
      </div>
    </div>

    <div class="full-width file-group">
      <button mat-raised-button color="primary" type="button" (click)="fileInput2.click()">
        Seleccionar Imagen 2
      </button>
      <input #fileInput2 type="file" hidden (change)="onFileChange($event, 2)" accept="image/*" />
      <mat-error
        *ngIf="registroPacienteForm.get('imagenPerfil2')?.hasError('required') && registroPacienteForm.get('imagenPerfil2')?.touched">
        La segunda imagen es obligatoria.
      </mat-error>
      <div class="preview" *ngIf="imagenPrevia2">
        <img [src]="imagenPrevia2" alt="Previsualización 2" />
      </div>
    </div>

    <div class="captcha-wrapper" style="margin: 1rem 0;">
      <ngx-recaptcha2 formControlName="recaptcha" [siteKey]="siteKey">
      </ngx-recaptcha2>

      <div class="error" *ngIf="registroPacienteForm.get('recaptcha')?.invalid 
                         && registroPacienteForm.get('recaptcha')?.touched">
        Debes completar el captcha.
      </div>
    </div>
    <button mat-raised-button color="primary" type="submit" [disabled]="registroPacienteForm.invalid">
      Registrarse
    </button>
  </form>
</mat-card>

<app-fab-bienvenida></app-fab-bienvenida> -->