<<<<<<< HEAD
 <!-- filtros -->
<input type="search"
       [formControl]="filterControl"
       placeholder="Filtrar por especialidad o especialista"
       aria-label="Filtro único por Especialidad o Especialista" />
<button type="button" class="btn btn--ghost" (click)="clearFilter()" [disabled]="!filterControl.value.length">
  Limpiar
</button>

<!-- tabla -->
<tbody *ngIf="vm$ | async as vm">
  <tr *ngFor="let t of vm.turnosFiltrados; trackBy: trackById">
    <td>{{ (t.fecha || t.fechaISO) | date:'dd/MM/yyyy' }}</td>
    <td>{{ t.hora }}</td>
    <td>{{ t.especialidad }}</td>
    <td>{{ t.especialista }}</td>
    <td>{{ t.pacienteNombre || ('Paciente ' + (t.pacienteId || '')) }}</td>
    <td><span [class]="estadoClass(t.estado)">{{ t.estado }}</span></td>
    <td class="col-actions">
      <button *ngIf="puedeCancelar(t.estado); else noAccion"
              type="button"
              class="btn btn--danger"
              (click)="abrirCancelacion(t)">
        Cancelar
      </button>
      <ng-template #noAccion><span class="muted">—</span></ng-template>
    </td>
  </tr>
</tbody>

<!-- modal -->
<div class="modal-backdrop" *ngIf="cancelTarget as target">
  <div class="modal">
    <h3>Cancelar turno</h3>
    <p>
      Estás por cancelar el turno de
      <strong>{{ target.pacienteNombre || ('Paciente ' + (target.pacienteId || '')) }}</strong>
      con el/la especialista <strong>{{ target.especialista }}</strong>
      ({{ target.especialidad }}) el
      <strong>{{ (target.fecha || target.fechaISO) | date:'dd/MM/yyyy' }}</strong>
      a las <strong>{{ target.hora }}</strong>.
    </p>
    <form [formGroup]="cancelForm" (ngSubmit)="confirmarCancelacion()">
      <label for="motivo" class="label">Motivo de cancelación <span class="req">*</span></label>
      <textarea id="motivo" formControlName="motivo" rows="4" placeholder="Escribe el motivo..." autofocus></textarea>
      <div class="form-hint" *ngIf="cancelForm.get('motivo')?.invalid && cancelForm.get('motivo')?.touched">
        Debe ingresar un comentario (mínimo 4 caracteres).
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn--ghost" (click)="cerrarCancelacion()" [disabled]="loadingCancel">Volver</button>
        <button type="submit" class="btn btn--danger" [disabled]="cancelForm.invalid || loadingCancel">
          {{ loadingCancel ? 'Cancelando…' : 'Confirmar cancelación' }}
        </button>
      </div>
    </form>
  </div>
</div>

 


 
 <!-- <section class="page">
  <header class="header">
    <h1>Turnos (Administrador)</h1>
    <div class="search">
      <input type="search" [formControl]="filterControl" placeholder="Filtrar por especialidad o especialista"
        aria-label="Filtro único por Especialidad o Especialista" />
      <button type="button" class="btn btn--ghost" (click)="clearFilter()"
        [disabled]="!(filterControl.value.length)">Limpiar</button>
    </div>
  </header>

  Chips de ayuda (no combobox) 
  <div class="chips-wrap" *ngIf="vm$ | async as vm">
    <div class="chips-group" *ngIf="vm.especialidades.length">
      <span class="chips-title">Especialidades:</span>
      <button type="button" class="chip chip--ghost" *ngFor="let e of vm.especialidades" (click)="setFilter(e)">{{ e
        }}</button>
    </div>

    <div class="chips-group" *ngIf="vm.especialistas.length">
      <span class="chips-title">Especialistas:</span>
      <button type="button" class="chip chip--ghost" *ngFor="let e of vm.especialistas"
        (click)="setFilter(e.apellido + ', ' + e.nombre)">
        {{ e.apellido }}, {{ e.nombre }}
      </button>
    </div>
  </div>

  Tabla 
  <div class="table-wrap" *ngIf="vm$ | async as vm">
    <table class="table">
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Hora</th>
          <th>Especialidad</th>
          <th>Especialista</th>
          <th>Paciente</th>
          <th>Estado</th>
          <th class="col-actions">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let t of vm.turnosFiltrados; trackBy: trackById">
          <td>{{ t.fecha | date:'dd/MM/yyyy' }}</td>
          <td>{{ t.hora }}</td>
          <td>{{ t.especialidad }}</td>
          <td>{{ t.especialista.apellido }}, {{ t.especialista.nombre }}</td>
          <td>{{ t.paciente.apellido }}, {{ t.paciente.nombre }}</td>
          <td><span [class]="estadoClass(t.estado)">{{ t.estado }}</span></td>
          <td class="col-actions">
            <button *ngIf="puedeCancelar(t); else noAccion" type="button" class="btn btn--danger"
              (click)="abrirCancelacion(t)">
              Cancelar
            </button>
            <ng-template #noAccion><span class="muted">—</span></ng-template>
          </td>
        </tr>
      </tbody>
    </table>

    <p class="muted" *ngIf="!vm.turnosFiltrados.length">Sin resultados para el filtro actual.</p>
    <p class="meta">Total de turnos: {{ vm.total }}</p>
  </div>

   Modal de cancelación 
  <div class="modal-backdrop" *ngIf="cancelTarget as target">
    <div class="modal">
      <h3>Cancelar turno</h3>
      <p>
        Estás por cancelar el turno de
        <strong>{{ target.pacienteNombre || ('Paciente ' + (target.pacienteId || '')) }}</strong>
        con el/la especialista
        <strong>{{ target.especialista }}</strong>
        ({{ target.especialidad }})
        el
        <strong>
          {{ target.fecha ? (target.fecha | date:'dd/MM/yyyy')
          : (target.fechaISO | date:'dd/MM/yyyy') }}
        </strong>
        a las
        <strong>
          {{ target.hora || (target.fecha ? (target.fecha | date:'HH:mm')
          : (target.fechaISO | date:'HH:mm')) }}
        </strong>.
      </p>

      <form [formGroup]="cancelForm" (ngSubmit)="confirmarCancelacion()">
        <label for="motivo" class="label">Motivo de cancelación <span class="req">*</span></label>
        <textarea id="motivo" formControlName="motivo" rows="4" placeholder="Escribe el motivo..." autofocus></textarea>
        <div class="form-hint" *ngIf="cancelForm.get('motivo')?.invalid && cancelForm.get('motivo')?.touched">
          Debe ingresar un comentario (mínimo 4 caracteres).
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn--ghost" (click)="cerrarCancelacion()"
            [disabled]="loadingCancel">Volver</button>
          <button type="submit" class="btn btn--danger" [disabled]="cancelForm.invalid || loadingCancel">
            {{ loadingCancel ? 'Cancelando…' : 'Confirmar cancelación' }}
          </button>
        </div>
      </form>
    </div>
  </div>

</section>

 -->
=======
<mat-card class="turnos-shell mat-elevation-z6">
  <h2 class="titulo">Filtrar Turnos</h2>

  <mat-form-field appearance="outline" class="buscador">
    <mat-label>Ingrese especialidad, nombre del especialista, paciente o patología…</mat-label>
    <!-- input matInput [value]="busqueda" (input)="applyFilter(($event.target as HTMLInputElement).value)"
      placeholder="Ej: dermatología, Juan, María, dermatitis, pendiente…" / -->


    <input matInput (input)="onFilterInput($event)"
      placeholder="Ej: dermatología, Juan, María, dermatitis, pendiente…" />

  </mat-form-field>

  <div class="grid">
    <!-- LISTA IZQUIERDA -->
    <section class="col list">
      <h3>Turnos</h3>

      <div class="items" *ngIf="!loading; else cargando">
        <button class="turno-item" *ngFor="let t of filtrados" [class.selected]="t === seleccionado"
          [class.ok]="estadoClass(t.estado)==='ok'" [class.warn]="estadoClass(t.estado)==='warn'"
          [class.bad]="estadoClass(t.estado)==='bad'" (click)="seleccionarTurno(t)">
          <span class="dot"></span>

          <span class="texto">
            <strong>{{ t.especialidad }}</strong>
            <span> — {{ t.fecha | date:'d \'de\' MMMM' }}</span>
          </span>

          <span class="badge" [class.ok]="estadoClass(t.estado)==='ok'" [class.warn]="estadoClass(t.estado)==='warn'"
            [class.bad]="estadoClass(t.estado)==='bad'">
            {{ t.estado }}
          </span>
        </button>

        <p class="sin-datos" *ngIf="filtrados.length === 0">No hay resultados para “{{ busqueda }}”.</p>
      </div>
    </section>

    <!-- PANEL DERECHO -->
    <section class="col info" *ngIf="seleccionado as s">
      <h3>Información</h3>

      <div class="campo">
        <label>Fecha</label>
        <div class="pill">{{ s.fecha | date:'dd/MM/yyyy' }} — {{ s.hora }}</div>
      </div>

      <div class="fila-2">
        <div class="campo">
          <label>Especialista</label>
          <div class="pill">{{ s.especialista }}</div>
        </div>

        <div class="campo">
          <label>Especialidad</label>
          <div class="pill">{{ s.especialidad }}</div>
        </div>
      </div>

      <div class="campo">
        <label>Estado</label>
        <div class="pill estado" [class.ok]="estadoClass(s.estado)==='ok'" [class.warn]="estadoClass(s.estado)==='warn'"
          [class.bad]="estadoClass(s.estado)==='bad'">
          {{ s.estado }}
        </div>
      </div>

      <div class="acciones">
        <button mat-raised-button color="warn" (click)="cancelarTurno(s)" [disabled]="!puedeCancelar(s)">
          <mat-icon>event_busy</mat-icon>
          Cancelar turno
        </button>
      </div>
    </section>
  </div>
</mat-card>

<!-- Diálogo de cancelación con comentario (se mantiene) -->
<ng-template #cancelDialog let-data>
  <h2 mat-dialog-title>Cancelar Turno</h2>
  <mat-dialog-content>
    <p>¿Estás seguro de que deseas cancelar este turno?</p>
    <p><strong>Paciente:</strong> {{ data?.turno?.paciente }}</p>
    <p><strong>Especialista:</strong> {{ data?.turno?.especialista }}</p>
    <p><strong>Especialidad:</strong> {{ data?.turno?.especialidad }}</p>
    <p><strong>Fecha:</strong> {{ data?.turno?.fecha | date:'shortDate' }} a las {{ data?.turno?.hora }}</p>

    <form [formGroup]="data?.form" style="margin-top: 16px;">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Motivo de cancelación</mat-label>
        <textarea matInput formControlName="comentario" rows="4"
          placeholder="Indica el motivo de la cancelación (mínimo 10 caracteres)"></textarea>
        <mat-error *ngIf="data?.form?.get('comentario')?.hasError('required')">El motivo es obligatorio</mat-error>
        <mat-error *ngIf="data?.form?.get('comentario')?.hasError('minlength')">Debe tener al menos 10
          caracteres</mat-error>
      </mat-form-field>
    </form>
  </mat-dialog-content>
  <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Cancelar</button>
    <button mat-raised-button color="warn" [disabled]="!data?.form?.valid" [mat-dialog-close]="true">
      Confirmar Cancelación
    </button>
  </mat-dialog-actions>
</ng-template>

<ng-template #cargando>
  <div class="loader">Cargando turnos…</div>
</ng-template>




<!-- <mat-card>
  <mat-card-title>Turnos de la Clínica</mat-card-title>

  <div class="toolbar">
    <mat-form-field appearance="outline">
      <mat-label>Buscar</mat-label>
      <input matInput #f (input)="applyFilter(f.value)" placeholder="Especialidad, especialista, paciente o estado" />
    </mat-form-field>
  </div>

  <div class="table-wrap">
    <table mat-table [dataSource]="dataSource" class="mat-elevation-z1">

       ID 
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>#</th>
        <td mat-cell *matCellDef="let t">{{ t.id | slice:0:8 }}</td>
      </ng-container>

       Fecha 
      <ng-container matColumnDef="fecha">
        <th mat-header-cell *matHeaderCellDef>Fecha</th>
        <td mat-cell *matCellDef="let t">{{ t.fecha | date:'shortDate' }}</td>
      </ng-container>

       Hora 
      <ng-container matColumnDef="hora">
        <th mat-header-cell *matHeaderCellDef>Hora</th>
        <td mat-cell *matCellDef="let t">{{ t.hora }}</td>
      </ng-container>

       Especialidad
      <ng-container matColumnDef="especialidad">
        <th mat-header-cell *matHeaderCellDef>Especialidad</th>
        <td mat-cell *matCellDef="let t">{{ t.especialidad }}</td>
      </ng-container>

       Especialista 
      <ng-container matColumnDef="especialista">
        <th mat-header-cell *matHeaderCellDef>Especialista</th>
        <td mat-cell *matCellDef="let t">{{ t.especialista }}</td>
      </ng-container>

       Paciente 
      <ng-container matColumnDef="paciente">
        <th mat-header-cell *matHeaderCellDef>Paciente</th>
        <td mat-cell *matCellDef="let t">{{ t.paciente }}</td>
      </ng-container>

      Estado 
      <ng-container matColumnDef="estado">
        <th mat-header-cell *matHeaderCellDef>Estado</th>
        <td mat-cell *matCellDef="let t">
          <span class="chip" [class.ok]="t.estado==='realizado'"
            [class.warn]="t.estado==='pendiente' || t.estado==='aceptado'"
            [class.bad]="t.estado==='cancelado' || t.estado==='rechazado'">
            {{ t.estado }}
          </span>
        </td>
      </ng-container>

       Acciones 
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef>Acciones</th>
        <td mat-cell *matCellDef="let t">
           Cancelar: Solo visible si no está Aceptado, Realizado o Rechazado 
          <button mat-button color="warn" (click)="cancelarTurno(t)" 
            [disabled]="!puedeCancelar(t)"
            *ngIf="puedeCancelar(t)">
            <mat-icon>event_busy</mat-icon> Cancelar
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns" class="header"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>
</mat-card>

 Diálogo de cancelación con comentario 
<ng-template #cancelDialog let-data>
  <h2 mat-dialog-title>Cancelar Turno</h2>
  <mat-dialog-content>
    <p>¿Estás seguro de que deseas cancelar este turno?</p>
    <p><strong>Paciente:</strong> {{ data?.turno?.paciente }}</p>
    <p><strong>Especialista:</strong> {{ data?.turno?.especialista }}</p>
    <p><strong>Especialidad:</strong> {{ data?.turno?.especialidad }}</p>
    <p><strong>Fecha:</strong> {{ data?.turno?.fecha | date:'shortDate' }} a las {{ data?.turno?.hora }}</p>
    
    <form [formGroup]="data?.form" style="margin-top: 16px;">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Motivo de cancelación</mat-label>
        <textarea matInput formControlName="comentario" rows="4" 
          placeholder="Indica el motivo de la cancelación (mínimo 10 caracteres)"></textarea>
        <mat-error *ngIf="data?.form?.get('comentario')?.hasError('required')">
          El motivo es obligatorio
        </mat-error>
        <mat-error *ngIf="data?.form?.get('comentario')?.hasError('minlength')">
          Debe tener al menos 10 caracteres
        </mat-error>
      </mat-form-field>
    </form>
  </mat-dialog-content>
  <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Cancelar</button>
    <button mat-raised-button color="warn" 
      [disabled]="!data?.form?.valid"
      [mat-dialog-close]="true">
      Confirmar Cancelación
    </button>
  </mat-dialog-actions>
</ng-template>
 -->
>>>>>>> 1-6-mas-estilos
